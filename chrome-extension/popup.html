<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      width: 340px;
      padding: 16px;
      background: #f9fafb;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }

    .header-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header-icon svg {
      width: 20px;
      height: 20px;
      color: white;
    }

    .header h1 {
      font-size: 16px;
      font-weight: 600;
      color: #1f2937;
    }

    .status {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status.success {
      background: #d1fae5;
      color: #065f46;
    }

    .status.error {
      background: #fee2e2;
      color: #991b1b;
    }

    .status.info {
      background: #e0e7ff;
      color: #3730a3;
    }

    .status.warning {
      background: #fef3c7;
      color: #92400e;
    }

    .status.processing {
      background: #dbeafe;
      color: #1e40af;
    }

    .property-preview {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
    }

    .property-preview h3 {
      font-size: 14px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 8px;
      line-height: 1.3;
    }

    .property-preview p {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .property-preview .url {
      font-size: 11px;
      color: #9ca3af;
      word-break: break-all;
    }

    .property-preview .added-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: #d1fae5;
      color: #065f46;
      font-size: 11px;
      font-weight: 500;
      padding: 4px 8px;
      border-radius: 4px;
      margin-top: 8px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      padding: 10px 12px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
    }

    .checkbox-group:hover {
      background: #f9fafb;
    }

    .checkbox-group input {
      width: 16px;
      height: 16px;
      accent-color: #7c3aed;
    }

    .checkbox-group label {
      font-size: 13px;
      color: #374151;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .checkbox-group .btr-badge {
      background: #7c3aed;
      color: white;
      font-size: 10px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Manual entry form */
    .manual-form {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
    }

    .manual-form h4 {
      font-size: 13px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-group label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 4px;
    }

    .form-group input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 13px;
    }

    .form-group input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .btn {
      width: 100%;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
    }

    .btn-primary:hover {
      opacity: 0.9;
    }

    .btn-primary:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: white;
      color: #374151;
      border: 1px solid #d1d5db;
      margin-top: 8px;
    }

    .btn-secondary:hover {
      background: #f9fafb;
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-warning {
      background: #f59e0b;
      color: white;
      margin-top: 8px;
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .progress-steps {
      margin-bottom: 16px;
    }

    .progress-step {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 0;
      font-size: 12px;
      color: #6b7280;
    }

    .progress-step.active {
      color: #1e40af;
      font-weight: 500;
    }

    .progress-step.completed {
      color: #065f46;
    }

    .progress-step.error {
      color: #991b1b;
    }

    .progress-step .step-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .progress-step .step-spinner {
      width: 14px;
      height: 14px;
      border: 2px solid #dbeafe;
      border-top-color: #3b82f6;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    .settings {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid #e5e7eb;
    }

    .settings-title {
      font-size: 12px;
      font-weight: 500;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .settings input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 12px;
    }

    .settings input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
    }

    .hidden {
      display: none !important;
    }

    /* Tag selection styles */
    .tag-selection {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .tag-selection-header {
      font-size: 12px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .tag-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 16px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .tag-chip:hover {
      opacity: 0.9;
    }

    .tag-chip.selected {
      border-color: #1f2937;
    }

    .tag-chip .tag-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .no-tags-message {
      font-size: 11px;
      color: #9ca3af;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
    </div>
    <h1>Rent Shortlist</h1>
  </div>

  <div id="status" class="status hidden"></div>

  <!-- Already Added View -->
  <div id="already-added-view" class="hidden">
    <div class="property-preview">
      <h3 id="added-title"></h3>
      <p id="added-address"></p>
      <p class="url" id="added-url"></p>
      <div class="added-badge">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>
        Already in shortlist
      </div>
    </div>
    <button id="open-app-btn-added" class="btn btn-primary">
      Open Rent Shortlist App
    </button>
  </div>

  <!-- Add Property View -->
  <div id="add-view">
    <div id="property-preview" class="property-preview">
      <h3 id="preview-title">Loading...</h3>
      <p id="preview-address"></p>
      <p class="url" id="preview-url"></p>
    </div>

    <!-- Progress Steps (shown during processing) -->
    <div id="progress-steps" class="progress-steps hidden">
      <div id="step-fetch" class="progress-step">
        <span class="step-icon">○</span>
        <span>Fetching property details...</span>
      </div>
      <div id="step-parse" class="progress-step">
        <span class="step-icon">○</span>
        <span>Parsing listing data...</span>
      </div>
      <div id="step-geocode" class="progress-step">
        <span class="step-icon">○</span>
        <span>Finding location...</span>
      </div>
      <div id="step-save" class="progress-step">
        <span class="step-icon">○</span>
        <span>Saving to shortlist...</span>
      </div>
    </div>

    <!-- Manual Entry Form (shown on failure) -->
    <div id="manual-form" class="manual-form hidden">
      <h4>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Enter details manually
      </h4>
      <div class="form-group">
        <label>Property Name *</label>
        <input type="text" id="manual-name" placeholder="e.g., 2 Bed Flat in Shoreditch">
      </div>
      <div class="form-group">
        <label>Address *</label>
        <input type="text" id="manual-address" placeholder="e.g., 123 High Street, London E1 6AB">
      </div>
      <div class="form-group">
        <label>Price (optional)</label>
        <input type="text" id="manual-price" placeholder="e.g., £2,500 pcm">
      </div>
    </div>

    <!-- Tag Selection -->
    <div id="tag-selection" class="tag-selection hidden">
      <div class="tag-selection-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
        Tags (optional)
      </div>
      <div id="tag-list" class="tag-list">
        <p class="no-tags-message">No tags available. Create tags in the main app first.</p>
      </div>
    </div>

    <button id="add-btn" class="btn btn-primary">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Add to Shortlist
    </button>

    <button id="retry-btn" class="btn btn-warning hidden">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/></svg>
      Retry with Manual Details
    </button>

    <button id="open-app-btn" class="btn btn-secondary">
      Open Rent Shortlist App
    </button>
  </div>

  <div class="settings">
    <div class="settings-title">App URL</div>
    <input type="text" id="app-url" placeholder="http://localhost:5173" value="http://localhost:5173">
    <p style="font-size: 10px; color: #9ca3af; margin-top: 4px;">API runs on port 3001 automatically</p>
  </div>

  <script src="popup.js"></script>
</body>
</html>
